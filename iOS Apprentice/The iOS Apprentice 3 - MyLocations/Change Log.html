<!DOCTYPE html>  
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>Change Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style id="mkstylesheet">
body{-webkit-font-smoothing:antialiased;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;margin:30px 0 0;padding:0;background:#fff}#wrapper{padding:20px}li{font-size:110%}li li{font-size:100%}li p{font-size:100%;margin:.5em 0}h1{color:#000}h2{color:#111}h3{color:#111;margin:0}h4{color:#111}h5{color:#111}h6{font-size:1em;line-height:1.5em;margin:1.5em 0}body,p,td,div{color:#111;font-family:"Helvetica Neue",Helvetica,Arial,Verdana,sans-serif;word-wrap:break-word}a{color:#0d6ea1;text-decoration:none;-webkit-transition:color 0.2s ease-in-out;-moz-transition:color 0.2s ease-in-out;-o-transition:color 0.2s ease-in-out;-ms-transition:color 0.2s ease-in-out;transition:color 0.2s ease-in-out}a:hover{color:#3593d9}body{font-size:15px;line-height:21px;margin:0 auto}h1{font-size:37px;line-height:42px;margin-top:42px;margin-bottom:21px}h2{font-size:27px;line-height:42px;margin-top:42px;margin-bottom:21px}h3{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}h4{font-size:20px;line-height:21px;margin-top:21px;margin-bottom:21px}p,ul,ol,pre,table,blockquote{margin-top:21px;margin-bottom:21px}hr{border:1px solid;margin:-1px 0}ul ul,ol ol,ul ol,ol ul{margin-top:0;margin-bottom:0}b,strong,em,small,code{line-height:1}.footnote{color:#0d6ea1;font-size:.8em;vertical-align:super}abbr,acronym{border-bottom:1px dotted #aaa}#wrapper img{max-width:100%;height:auto}dd{font-size:1em;margin-bottom:1em}li>p:first-child{margin:0}ul ul,ul ol{margin-bottom:.4em}caption,col,colgroup,table,tbody,td,tfoot,th,thead,tr{border-spacing:0}table{border:1px solid rgba(0,0,0,0.25);border-collapse:collapse;display:table;empty-cells:hide;margin:-1px 0 1.3125em;padding:0;table-layout:fixed}caption{display:table-caption;font-weight:700}col{display:table-column}colgroup{display:table-column-group}tbody{display:table-row-group}tfoot{display:table-footer-group}thead{display:table-header-group}td,th{display:table-cell}tr{display:table-row}table th,table td{font-size:1.1em;line-height:1.3;padding:.5em 1em 0}table thead{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-bottom:1px solid rgba(0,0,0,0.2)}table tbody{background:rgba(0,0,0,0.05)}table tfoot{background:rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.15);border-top:1px solid rgba(0,0,0,0.2)}figure{display:inline-block;overflow:hidden;position:relative;margin:1em 0 2em}figcaption{font-style:italic;text-align:center;background:white;color:#666}.poetry pre{display:block;font-family:Georgia,Garamond,serif !important;font-size:110% !important;font-style:italic;line-height:1.6em;margin-left:1em}.poetry pre code{font-family:Georgia,Garamond,serif !important;word-break:break-all;word-break:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;hyphens:auto;white-space:pre-wrap}blockquote p{font-size:110%;font-style:italic;line-height:1.6em}sup,sub,a.footnote{font-size:1.4ex;height:0;line-height:1;position:relative;vertical-align:super}sub{vertical-align:sub;top:-1px}p,h5{font-size:1.1429em;line-height:1.3125em;margin:1.3125em 0}dt,th{font-weight:700}table tr:nth-child(odd),table th:nth-child(odd),table td:nth-child(odd){background:rgba(255,255,255,0.06)}table tr:nth-child(even),table td:nth-child(even){background:rgba(200,200,200,0.25)}@media print{img,table,figure{page-break-inside:avoid}#wrapper{background:#fff;color:#303030;padding:10px;position:relative;text-indent:0}}@media screen{.inverted{background:#252a2a}.inverted #wrapper{background:#252a2a;color:#eee}.inverted hr{border-color:#333f40 !important}.inverted p,.inverted td,.inverted li,.inverted h1,.inverted h2,.inverted h3,.inverted h4,.inverted h5,.inverted h6,.inverted th,.inverted .math,.inverted caption,.inverted dt,.inverted dd{color:#eee}.inverted pre{background:#ccc}.inverted pre code{color:#111}.inverted table{background:none}.inverted table tr:nth-child(odd),.inverted table td:nth-child(odd){background:none}.inverted a{color:#acd1d5}::selection{background:rgba(157,193,200,0.5)}h1::selection{background-color:rgba(45,156,208,0.3)}h2::selection{background-color:rgba(90,182,224,0.3)}h3::selection,h4::selection,h5::selection,h6::selection,li::selection,ol::selection{background-color:rgba(133,201,232,0.3)}code::selection{background-color:rgba(0,0,0,0.7);color:#eee}code span::selection{background-color:rgba(0,0,0,0.7) !important;color:#eee !important}a::selection{background-color:rgba(255,230,102,0.2)}.inverted a::selection{background-color:rgba(255,230,102,0.6)}td::selection,th::selection,caption::selection{background-color:rgba(180,237,95,0.5)}}
#mkreplaced-toc{list-style-position:inside;padding:0;margin:0 0 0 1rem;list-style-type:none}#mkreplaced-toc li::before{content:''}#mkreplaced-toc li{font-size:1.5rem;line-height:1.5;font-weight:normal}#mkreplaced-toc li ul{font-size:1.3rem;font-weight:300;padding:.5rem 0;margin:0 0 0 1rem}#mkreplaced-toc li.missing{list-style-type:none !important}#mkreplaced-toc.max-1 ul,#mkreplaced-toc.max1 ul{display:none}#mkreplaced-toc.max-2 ul ul,#mkreplaced-toc.max2 ul ul{display:none}#mkreplaced-toc.max-3 ul ul ul,#mkreplaced-toc.max3 ul ul ul{display:none}#mkreplaced-toc.max-4 ul ul ul ul,#mkreplaced-toc.max4 ul ul ul ul{display:none}#mkreplaced-toc.max-5 ul ul ul ul ul,#mkreplaced-toc.max5 ul ul ul ul ul{display:none}

@media print{
#wrapper #generated-toc-clone,#generated-toc{display:none!important}
}
#wrapper #generated-toc-clone, #wrapper #mkreplaced-toc, #wrapper #generated-toc-clone ul, #wrapper #mkreplaced-toc ul {
    list-style-position: inside
}
#wrapper #generated-toc-clone li.missing, #wrapper #mkreplaced-toc li.missing {
    list-style-type: none!important
}
#wrapper #generated-toc-clone, #wrapper #mkreplaced-toc {
    list-style-type: upper-roman
}
#wrapper #generated-toc-clone>li>ul, #wrapper #mkreplaced-toc>li>ul  {
    list-style-type: decimal
}
#wrapper #generated-toc-clone>li>ul>li>ul, #wrapper #mkreplaced-toc>li>ul>li>ul {
    list-style-type: decimal-leading-zero
}
#wrapper #generated-toc-clone>li>ul>li>ul>li>ul, #wrapper #mkreplaced-toc>li>ul>li>ul>li>ul {
    list-style-type: lower-greek
}
#wrapper #generated-toc-clone>li>ul>li>ul>li>ul>li>ul, #wrapper #mkreplaced-toc>li>ul>li>ul>li>ul>li>ul {
    list-style-type: disc
}
#wrapper #generated-toc-clone>li>ul>li>ul>li>ul>li>ul>li>ul, #wrapper #mkreplaced-toc>li>ul>li>ul>li>ul>li>ul>li>ul {
    list-style-type: square
}
#wrapper #generated-toc-clone,#wrapper #mkreplaced-toc{list-style-position:outside!important;margin-left:3rem;}
</style>

</head>
<body class="normal firstload">
  <div id="wrapper">
      <h1 id="theiosapprentice3:mylocations">The iOS Apprentice 3: MyLocations</h1>

<h2 id="version4.09september2015">Version 4.0 (9 September 2015)</h2>

<p>Updated for Xcode 7.0, Swift 2.0, and iOS 9.0.</p>

<p>Swift 2.0 is not backwards compatible with Swift 1.2. If you&#8217;re a reader of the previous edition of this book, you can convert your source code using Xcode&#8217;s <strong>Edit -&gt; Convert -&gt; To Latest Swift Syntax</strong> menu. However, this won&#8217;t convert everything.</p>

<p>This file points out the most important changes to the source code with respect to the previous edition. Most of the changes are similar to those of tutorial 2. The following are changes specific to tutorial 3:</p>

<h3 id="errorhandling">Error handling</h3>

<p>In most of the iOS SDK the use of <code>NSError</code> objects has been replaced by a new error handling mechanism, <code>do-try-catch</code>.</p>

<p>Instead of writing,</p>

<pre><code>var error: NSError?  
if let store = coordinator.addPersistentStoreWithType(NSSQLiteStoreType,  
         configuration: nil, URL: storeURL, options: nil, error: &amp;error) {  
  ...  
} else {  
  println(&quot;Error adding persistent store at \(storeURL): \(error!)&quot;)  
}
</code></pre>

<p>you now write:</p>

<pre><code>do {  
  try coordinator.addPersistentStoreWithType(NSSQLiteStoreType,  
                        configuration: nil, URL: storeURL, options: nil)  
  ...  
} catch {  
    fatalError(&quot;Error adding persistent store at \(storeURL): \(error)&quot;)  
}
</code></pre>

<p>Note: <code>NSError</code> is still used for errors in the <code>CLLocationManager</code> delegate, both for obtaining GPS coordinates and for reverse geocoding. </p>

<h3 id="anyobject">AnyObject</h3>

<p>Many iOS APIs now have the proper data types. In the previous version of Swift, many objects were represented as type <code>AnyObject</code> and you had to cast them to the proper type. This is no longer necessary in most cases.</p>

<p>For example, </p>

<pre><code>func locationManager(manager: CLLocationManager!, didUpdateLocations locations: [AnyObject]!) {  
  let newLocation = locations.last as! CLLocation
</code></pre>

<p>is now written as:</p>

<pre><code>func locationManager(manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) {  
  let newLocation = locations.last!
</code></pre>

<p>The <code>locations</code> array already knows it contains <code>CLLocation</code> objects instead of <code>AnyObject</code>. Therefore, a lot fewer <code>as!</code> casts are necessary.</p>

<h3 id="uibuttonconstruction">UIButton construction</h3>

<p>To create a <code>UIButton</code> from code, you used to have to write:</p>

<pre><code>let button = UIButton.buttonWithType(.Custom) as! UIButton
</code></pre>

<p>Now you can simply write:</p>

<pre><code>let button = UIButton(type: .Custom)
</code></pre>

<h3 id="otherchanges">Other changes</h3>

<p>The <code>stringByAppendingPathComponent()</code> method no longer works on <code>String</code> objects, you have to cast to <code>NSString</code> first:</p>

<pre><code>return (applicationDocumentsDirectory as NSString).stringByAppendingPathComponent(filename)
</code></pre>

<p><code>join()</code> is now <code>joinWithSeparator()</code>:</p>

<pre><code>searchResult.genre = (genres as! [String]).joinWithSeparator(&quot;, &quot;)
</code></pre>

<h2 id="version3.310april2015">Version 3.3 (10 April 2015)</h2>

<p>Updated for Xcode 6.3 and Swift 1.2. Because Swift 1.2 is not backwards compatible with Swift 1.1, a number of changes need to be made to the source code.</p>

<h5 id="newtypecastingoperator:as">New type casting operator: <code>as!</code></h5>

<p>Almost all the <code>as</code> type casts are now written <code>as!</code>. (See the Change Log for part 2 for a detailed description.)</p>

<p>However, there are two exceptions to this change, both in <strong>LocationDetailsViewController.swift</strong>:</p>

<p>1) Inside <code>imagePickerController(didFinishPickingMediaWithInfo)</code>, the line that reads the <code>UIImage</code> from the info dictionary currently is:</p>

<pre><code>image = info[UIImagePickerControllerEditedImage] as UIImage?
</code></pre>

<p>This should become:</p>

<pre><code>image = info[UIImagePickerControllerEditedImage] as? UIImage
</code></pre>

<p>You could change this to <code>as! UIImage?</code>, but using the optional <code>as?</code> cast is simpler and does the same thing.</p>

<p>2) In <code>textView(shouldChangeTextInRange, replacementText)</code>, the following cast should remain unchanged:</p>

<pre><code>descriptionText = (textView.text as NSString).stringByReplacing...
</code></pre>

<p>The type of <code>textView.text</code> is <code>String</code> and this is &#8220;bridged&#8221; with <code>NSString</code>, so this kind of cast can never fail. That&#8217;s why you don&#8217;t need <code>as!</code> or <code>as?</code> here.</p>

<h5 id="fixedacrashingbugwitheditinglocationsfromthemapscreen">Fixed a crashing bug with editing locations from the Map screen</h5>

<p>To reproduce this bug, launch the app and immediately switch to the Map tab. Tap a location to edit it and change its description. After you press Done, the app crashes with the message, &#8220;fatal error: unexpectedly found nil while unwrapping an Optional value&#8221;. (This crash does not happen when you change the location&#8217;s category, only the description.)</p>

<p>The fix: In <strong>LocationsViewController.swift</strong>, in the extension for the <code>NSFetchedResultsControllerDelegate</code>, the code in <code>case .Update</code> should be:</p>

<pre><code>case .Update:  
  println(&quot;*** NSFetchedResultsChangeUpdate (object)&quot;)  
  if let cell = tableView.cellForRowAtIndexPath(indexPath!) as? LocationCell {  
    let location = controller.objectAtIndexPath(indexPath!) as! Location  
    cell.configureForLocation(location)  
  }  
</code></pre>

<p>This puts the call to <code>tableView.cellForRowAtIndexPath()</code> inside an <code>if let</code> statement, so that the rest of the code is skipped when this returns <code>nil</code>.</p>

<p>In case youâ€™re interested, this bug is actually the result of the workaround for another bug. (Don&#8217;t you just love programming?)</p>

<p>The section on using <code>NSFetchedResultsController</code> describes a problem with Core Data &#8211; the &#8220;FATAL ERROR: The persistent cache of section information does not match the current configuration&#8221; crash.</p>

<p>One proposed solution to prevent this from occurring was to add the following line to <strong>AppDelegate.swift</strong>:</p>

<pre><code>let forceTheViewToLoad = locationsViewController.view
</code></pre>

<p>That solved the Core Data caching problem, but it also introduced this sneaky new bug into the Map screen.</p>

<p>Let this be a lesson that even a fairly simple app such as this can have all kinds of complicated bugs hidden inside it. ;-)</p>

<h2 id="version3.28december2014">Version 3.2 (8 December 2014)</h2>

<ul>
<li><p>Updated for Xcode 6.1.1.</p></li>
<li><p><code>UITableViewCell</code>&#8217;s <code>textLabel</code> property is an optional again. This became an implicitly-unwrapped optional in Xcode 6.1, but as of Xcode 6.1.1 it has changed back to a true optional and requires unwrapping with <code>!</code> or <code>if let</code>.</p></li>
</ul>

<h2 id="version3.117october2014">Version 3.1 (17 October 2014)</h2>

<ul>
<li><p>Updated for Xcode 6.1 and iOS 8.1.</p></li>
<li><p><code>toRaw()</code> on enumerations is now called <code>rawValue</code>.</p></li>
<li><p><code>NSError.errorWithDomain(...)</code> changed to <code>NSError(domain: ...)</code></p></li>
<li><p>The type of the <code>sender</code> parameter in <code>prepareForSegue(sender)</code> is <code>AnyObject?</code> instead of <code>AnyObject!</code>.</p></li>
<li><p>To set the text on a table view cell you now write <code>cell.textLabel.text</code> instead of <code>cell.textLabel!.text</code> &#8211; the <code>textLabel</code> property is no longer an optional.</p></li>
<li><p>Added a short explanation of failable initializers.</p></li>
<li><p><code>UIImage(named)</code> is a failable initializer, returning an optional that may be <code>nil</code>. Loading the HUD image now requires <code>if let</code> to unwrap this optional.</p></li>
<li><p>When creating the <code>NSManagedObjectModel</code>, the <code>as NSManagedObjectModel!</code> cast is no longer needed.</p></li>
<li><p>The <code>name</code> property from <code>NSFetchedResultsSectionInfo</code> is now an optional, so to use it you write: <code>return sectionInfo.name!.uppercaseString</code></p></li>
</ul>

<h2 id="version3.08october2014">Version 3.0 (8 October 2014)</h2>

<p>First release of the Third Edition.</p>
<!-- ##END MARKED WRAPPER## -->
    </div>
</body>
</html>